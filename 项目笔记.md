# 众筹合约项目笔记

## 工厂模式下的智能合约

### 数据查询问题

由合约工厂生产合约，可以很容易直接在工厂合约下就查询到1个用户使用工厂创建的所有合约。
但是用户使用这些合约时，是直接使用子合约的，如果要通过工厂，查询平台范围内某个用户使用过的所有子合约，就不那么简单了。
举例如下：

    A 使用工厂创建 合约1、合约2.合约3
    B 使用工厂创建 合约4、合约5.合约6

只需在创建时，记录进A的记录中即可。创建在工厂发生，查询数据也在工厂查询，无需跨合约传递数据

    C 参与了合约1,合约5
    D 参与了合约1，合约2，合约4.

需要在C参与子合约时，记录进C的记录，在将记录传入工厂，C即可在工厂查询自己的记录了。

1. 一般使用mapping存储这些记录，可mapping不支持传递，
2. 如果在工厂合约设置mapping变量，子合约通过工厂对象，访问并修改这个变量，也可行。但太危险，封装性太差。

解决方案：添加个记录器合约，链接所有子合约和工厂合约，用户通过工厂合约里的记录器合约对象来读取记录器，用户产生参记录时，直接通过记录器合约对象，访问和修改记录器。

## 对象传递问题

既然合约的数据都在链上，每个合约是不是都可以创建自己的合约对象去访问某个合约呢？
这种说法错误，举例子：

有有A.B,C，3个合约，A合约通过new一个C合约的对象修改了C合约内的状态变量。然后B合约也通过new一个C合约的对象去访问C合约内的状态变量，能访问到修改后的值吗？

答案：不可以，A和B是自己分别new的C对象，实际上是创建了两个独立的子合约，互不影响。

如何解决呢？操作同一个合约对象呗，要么通过1个地址获取到这个合约对象，要么通过传递接收这个合约对象，一定不要自己去new，new出来的是独立新合约。
